<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="OSCP-7: Active Information Gathering" /><meta name="author" content="Adrià" /><meta property="og:locale" content="en" /><meta name="description" content="Chapter 7: Active Information Gathering" /><meta property="og:description" content="Chapter 7: Active Information Gathering" /><link rel="canonical" href="https://adriapt.github.io/posts/OSCP-7/" /><meta property="og:url" content="https://adriapt.github.io/posts/OSCP-7/" /><meta property="og:site_name" content="Adrià Pagès" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-21T08:10:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="OSCP-7: Active Information Gathering" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Adrià"},"dateModified":"2022-07-25T14:07:56+02:00","datePublished":"2022-07-21T08:10:00+02:00","description":"Chapter 7: Active Information Gathering","headline":"OSCP-7: Active Information Gathering","mainEntityOfPage":{"@type":"WebPage","@id":"https://adriapt.github.io/posts/OSCP-7/"},"url":"https://adriapt.github.io/posts/OSCP-7/"}</script><title>OSCP-7: Active Information Gathering | Adrià Pagès</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Adrià Pagès"><meta name="application-name" content="Adrià Pagès"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/profilepic.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Adrià Pagès</a></div><div class="site-subtitle font-italic">My knowledge Hub</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about_me/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/Adriapt" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['adria.pagest','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>OSCP-7: Active Information Gathering</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>OSCP-7: Active Information Gathering</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1658383800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 21, 2022 </em> </span> <span> Updated <em class="" data-ts="1658750876" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 25, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> Adrià Pagès Torruella </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3089 words"> <em>17 min</em> read</span></div></div></div><div class="post-content"><h1 id="chapter-7-active-information-gathering">Chapter 7: Active Information Gathering</h1><hr /><p>In the previous post we explored some ways to obtain information about a user without directly interacting with him, but in this post we will explore the most common ways to obtain information about a user that involve direct interaction with target services.</p><h2 id="dns-enumeration"><span class="mr-2">DNS Enumeration</span><a href="#dns-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The Domain Name System (DNS) is a distributed database that allows the translation of domain names into IP addresses. The database follows a hierarchical structure divided into several zones, starting with the <strong>root level domain</strong>. Let’s learn how DNS works before learning how to enumerate it.</p><p>The next image shows the hierarchical structure of DNS:</p><p><img data-src="/img/posts/2022-07-21-OSCP-7/dnsstructure.png" alt="DNS Structure" data-proofer-ignore></p><p>The root Server contains the IP of the top level domain servers and they contain the addresses of second level domain servers etc.</p><p>But how is this structure used?</p><p>When you search for a hostname like “example.com” in your browser, the host name is sent to the OS DNS client, which is going to forward a request to the configured name server. This name server is known as a DNS recursor and is the one who will interact with the DNS structure, not your host:</p><ol><li>The recursor send the query to the root domain.<li>The root domain answers with the address of the <strong>Top level domain</strong> (TLD). In this example the TLD will be .com.<li>The recursor sends the query to the TLD .com.<li>The TLD will answer with the <strong>Second level domain</strong> example.com address.<li>The recursor will send the query to the example.com DNS server (Authoritative Name Server). An authoritative name server contains the DNS records in a local database known as a <strong>zone file</strong>. There are usually two zone files for each domain:<ul><li><strong>Forward lookup zone:</strong> Translates names into IP addresses.<li><strong>Reverse lookup zone:</strong> Translates IP addresses into names.</ul><li>The authoritative name server answers with the corresponding IP address.<li>The recursor sends the IP back to the DNS client that runs inside the host and it will be able to access to the correct host and load the webpage.</ol><p><img data-src="/img/posts/2022-07-21-OSCP-7/dns-lookup-diagram.png" alt="dns-lookup-process" data-proofer-ignore></p><p>To avoid doing this process everytime, browsers and name servers have a cache that stores DNS records.<br /> There are different type of DNS records that a domain can use:</p><ul><li><strong>NS</strong>: <strong>Nameserver</strong> records contain the name of the authoritative servers that host DNS records for a domain.<li><strong>A</strong>: <strong>Host record</strong> contains the IP address of a hostname.<li><strong>MX</strong>: <strong>Mail Exchange</strong> records contain the name of the servers that handle email for that domain.<li><strong>PTR</strong>: <strong>Pointer Records</strong> are used in reverse lookup and they contain records associated with an IP address.<li><strong>CNAME</strong>: <strong>Canonical Name Records</strong> are used to create aliases for other host records.<li><strong>TXT</strong>: <strong>Text Records</strong> contain arbitary data that can be used for various purposes.</ul><p>Let’s do some practical examples:</p><p>First, we will use the <strong>host</strong> command to find the IP address of www.google.com:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>❯ host www.google.com
www.google.com has address 142.250.201.68
www.google.com has IPv6 address 2a00:1450:4003:80c::2004
</pre></table></code></div></div><p>The <strong>host</strong> command will search for an <strong>A</strong> record unless we specify what we want. We can use the <strong>-t</strong> option to specify what kind of record we are searching for:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>❯ host -t mx google.com
google.com mail is handled by 10 smtp.google.com.
</pre></table></code></div></div><p>Note that I searched for the <strong>MX</strong> record, but instead of the www.google.com i used the google.com domain.</p><p>An important technique to obtain domain names is using brute force with wordlists. We could create a bash script that executes the host command searching for exiting subdomains. There are tools that can do this like <a href="https://github.com/OJ/gobuster">gobuster</a> or <strong>wfuzz</strong>.</p><p>We could also do reverse lookups brute forcing the IP addresses within a network.</p><h3 id="dns-zone-transfers"><span class="mr-2">DNS Zone Transfers</span><a href="#dns-zone-transfers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A zone transfer is a database replication between related DNS servers which the <strong>zone file</strong> is copied from a master DNS server to a slave server. Theoretically, just authorized DNS servers should be able to ask for a zone transfer, but many administrators misconfigure DNS servers and anyone can reccive a copy of the DNS zone file.</p><p>We can use the <strong>host</strong> command again with the <strong>-l</strong> option to ask for a zone transfer. We must provide the domain name and the DNS server address/name. Since we need a DNS server name to do the zone transfer, we can first do the <code class="language-plaintext highlighter-rouge">host -t ns google.com</code> to obtain the names and then try the zone transfers for each DNS server:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>❯ host <span class="nt">-t</span> ns google.com
google.com name server ns1.google.com.
google.com name server ns3.google.com.
google.com name server ns2.google.com.
google.com name server ns4.google.com.
❯ host <span class="nt">-l</span> google.com ns1.google.com
Using domain server:
Name: ns1.google.com
Address: 216.239.32.10#53
Aliases: 

<span class="p">;</span> Transfer failed.
❯ host <span class="nt">-l</span> google.com ns2.google.com
Using domain server:
Name: ns2.google.com
Address: 216.239.34.10#53
Aliases: 

<span class="p">;</span> Transfer failed.
❯ host <span class="nt">-l</span> google.com ns3.google.com
Using domain server:
Name: ns3.google.com
Address: 216.239.36.10#53
Aliases: 

<span class="p">;</span> Transfer failed.
</pre></table></code></div></div><p>We can see that Google has everything properly configured and we are not allowed to do zone transfers. We could also run a script to do this automatically, but there are tools that already do this, like DNSRecon: <code class="language-plaintext highlighter-rouge">dnsrecon -d google.com -t axfr</code> where <strong>-d</strong> allows us to specify the domain and <strong>-t</strong> to specify the type of enumeration that we want (in this case, a zone transfer).</p><p>Another tool is the DNSenum. We can run this tool against the <strong>zonetransfer.me</strong> (a domain created specifically to allow zone transfers and do tests). Here we can see part of the output:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
</pre><td class="rouge-code"><pre>❯ dnsenum zonetransfer.me
Smartmatch is experimental at /usr/bin/dnsenum line 698.
Smartmatch is experimental at /usr/bin/dnsenum line 698.
dnsenum.pl VERSION:1.2.4

<span class="nt">-----</span>   zonetransfer.me   <span class="nt">-----</span>


Host<span class="s1">'s addresses:
__________________

zonetransfer.me.                         5        IN    A        5.196.105.14


Name Servers:
______________

nsztm1.digi.ninja.                       5        IN    A        81.4.108.41
nsztm2.digi.ninja.                       5        IN    A        34.225.33.2


Mail (MX) Servers:
___________________

ALT1.ASPMX.L.GOOGLE.COM.                 5        IN    A        142.250.153.26
ASPMX2.GOOGLEMAIL.COM.                   5        IN    A        142.250.153.26
ASPMX4.GOOGLEMAIL.COM.                   5        IN    A        142.250.150.27
ASPMX.L.GOOGLE.COM.                      5        IN    A        108.177.15.27
ASPMX3.GOOGLEMAIL.COM.                   5        IN    A        142.251.9.26
ASPMX5.GOOGLEMAIL.COM.                   5        IN    A        74.125.200.26
ALT2.ASPMX.L.GOOGLE.COM.                 5        IN    A        142.251.9.26


Trying Zone Transfers and getting Bind Versions:
_________________________________________________


Trying Zone Transfer for zonetransfer.me on nsztm1.digi.ninja ... 
zonetransfer.me.                         7200     IN    SOA               (
zonetransfer.me.                         300      IN    HINFO        "Casio
zonetransfer.me.                         301      IN    TXT               (
zonetransfer.me.                         7200     IN    MX                0
zonetransfer.me.                         7200     IN    MX               10
zonetransfer.me.                         7200     IN    MX               10
zonetransfer.me.                         7200     IN    MX               20
zonetransfer.me.                         7200     IN    MX               20
zonetransfer.me.                         7200     IN    MX               20
zonetransfer.me.                         7200     IN    MX               20
zonetransfer.me.                         7200     IN    A        5.196.105.14
zonetransfer.me.                         7200     IN    NS       nsztm1.digi.ninja.
zonetransfer.me.                         7200     IN    NS       nsztm2.digi.ninja.
_acme-challenge.zonetransfer.me.         301      IN    TXT               (
_sip._tcp.zonetransfer.me.               14000    IN    SRV               0
14.105.196.5.IN-ADDR.ARPA.zonetransfer.me. 7200     IN    PTR      www.zonetransfer.me.
asfdbauthdns.zonetransfer.me.            7900     IN    AFSDB             1
asfdbbox.zonetransfer.me.                7200     IN    A         127.0.0.1
asfdbvolume.zonetransfer.me.             7800     IN    AFSDB             1
canberra-office.zonetransfer.me.         7200     IN    A        202.14.81.230
cmdexec.zonetransfer.me.                 300      IN    TXT              ";
contact.zonetransfer.me.                 2592000  IN    TXT               (
dc-office.zonetransfer.me.               7200     IN    A        143.228.181.132
deadbeef.zonetransfer.me.                7201     IN    AAAA     dead:beaf::
dr.zonetransfer.me.                      300      IN    LOC              53
DZC.zonetransfer.me.                     7200     IN    TXT         AbCdEfG
email.zonetransfer.me.                   2222     IN    NAPTR             (
email.zonetransfer.me.                   7200     IN    A        74.125.206.26
Hello.zonetransfer.me.                   7200     IN    TXT             "Hi
home.zonetransfer.me.                    7200     IN    A         127.0.0.1
Info.zonetransfer.me.                    7200     IN    TXT               (
internal.zonetransfer.me.                300      IN    NS       intns1.zonetransfer.me.
internal.zonetransfer.me.                300      IN    NS       intns2.zonetransfer.me.
intns1.zonetransfer.me.                  300      IN    A        81.4.108.41
intns2.zonetransfer.me.                  300      IN    A        167.88.42.94
office.zonetransfer.me.                  7200     IN    A        4.23.39.254
ipv6actnow.org.zonetransfer.me.          7200     IN    AAAA     2001:67c:2e8:11::c100:1332
owa.zonetransfer.me.                     7200     IN    A        207.46.197.32
robinwood.zonetransfer.me.               302      IN    TXT          "Robin
rp.zonetransfer.me.                      321      IN    RP                (
sip.zonetransfer.me.                     3333     IN    NAPTR             (
sqli.zonetransfer.me.                    300      IN    TXT              "'</span>
sshock.zonetransfer.me.                  7200     IN    TXT             <span class="s2">"()
staging.zonetransfer.me.                 7200     IN    CNAME    www.sydneyoperahouse.com.
alltcpportsopen.firewall.test.zonetransfer.me. 301      IN    A         127.0.0.1
testing.zonetransfer.me.                 301      IN    CNAME    www.zonetransfer.me.
vpn.zonetransfer.me.                     4000     IN    A        174.36.59.154
www.zonetransfer.me.                     7200     IN    A        5.196.105.14
xss.zonetransfer.me.                     300      IN    TXT      "</span><span class="s1">'&gt;&lt;script&gt;alert('</span>Boo<span class="s1">')&lt;/script&gt;"
</span></pre></table></code></div></div><h2 id="port-scanning"><span class="mr-2">Port Scanning</span><a href="#port-scanning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When we have the IP of the hosts that we want to test, the first thing we should enumerate is their ports. Port Scanning is the process of inspecting TCP and UDP ports and detect what services are running.</p><p>There are a lot of different port scanning techniques and tools. We can do it manually using <strong>netcat</strong>. Since ports may run TCP or UDP protocols, it’s important to consider it when scanning.</p><h3 id="tcp-scanning"><span class="mr-2">TCP Scanning</span><a href="#tcp-scanning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The most used TCP scan technique is the <strong>CONNECT</strong> scanning, where the scanner host establishes a TCP connection finishing the <strong>three-way handshake</strong> that the TCP protocol defines. In this protocol, the host sends a TCP packet with the <strong>SYN</strong> flag to the destination port. If that port is open, that server sends back a packet with the <strong>SYN-ACK</strong> packet, which has the <strong>SYN</strong> flag and acknowledges the first received packet. Finally, the client sends acknowledges the packet that the server sent with an <strong>ACK</strong> packet and the connection is established. This scanning technique considers the port open if the handshake is finished. The next picture summarizes the handshake protocol:</p><p><img data-src="/img/posts/2022-07-21-OSCP-7/three-way.jpg" alt="Three-way handshake" data-proofer-ignore></p><p>We can do this with nectat by doing: <code class="language-plaintext highlighter-rouge">nc -nvv -w 1 -z 1.1.1.1 1-99</code> where <strong>-w</strong> specifies a connection timeout (1 sec) and -z to specify that we don’t want to send any data. In this example we will only scan all the ports from 1 to 99.</p><h3 id="udp-scanning"><span class="mr-2">UDP Scanning</span><a href="#udp-scanning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>UDP is stateless, this means that doesn’t ensure that the packets are correctly received because packets are not acknowledged. In this situation, a port may be open and receive the packet, but will send no answer back to the client. This will depend on how the application running on that port handles UDP packets. However, when a port is closed, by design, the response should be an ICMP packet with the <strong>port unreachable</strong>. However, if a port is filtered by a firewall, it’s difficult to know if the port is filtered or open.</p><h3 id="nmap"><span class="mr-2">Nmap</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If we talk about tools, <strong>nmap</strong> is the best one. A default nmap scan will scan just the first 1000 ports, but we can scan all of them using the <strong>-p-</strong> option. <strong>Nmap</strong> has a huge amount of options an scan types and we are not going to define all of them here, just the most important.</p><ul><li><p><strong>Stealth/SYN Scann</strong>: Is the default scanning technique. This scan sends the <strong>SYN</strong> packets, but doesn’t finish the full TCP handshake. If the port is open, the <strong>SYN-ACK</strong> packet will be received and the port will be marked as open. Since the TCP is not finished, the information is not passed to the application layer and will not appear in the application logs. This scan requires raw socket privileges (run nmap with <strong>sudo</strong>).</p><li><p><strong>TCP Connect Scann:</strong> This is the default scan used when nmap doesn’t have privileges. This technique has been described when talking about TCP scan previously. We can use the <strong>-sT</strong> option to tell nmap that we want to use this scan type.</p><li><p><strong>UDP Scann:</strong> As mentioned before, when doing UDP scans is difficult to know if a port is open or not. However, for de common ports used for known applications, nmap generates specific protocol packets to get a specific response.</p></ul><p>Nmap scans can generate a lot of traffic. If we want to scan large networks, we can first do a scan using the <strong>-sn</strong> option to do a host discovery first. Once we have the hosts that are up, then we can perform more aggresive scans against them scanning all their ports, detecting OS, using scripts, etc. I suggest to read the nmap manual page to know all options offered.</p><h2 id="smb-enumeration"><span class="mr-2">SMB Enumeration</span><a href="#smb-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Server Message Block (SMB) is a protocol that due to its complex implementation it has security problems. SMB is a client/server protocol that allows access to shared files, directories and other resources such as printers, routers, etc. This protocol uses the <strong>port 445</strong> and the TCP protocol.</p><h3 id="netbios-service"><span class="mr-2">NetBIOS Service</span><a href="#netbios-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>NetBios is a network protocol that allows distributed applications to access each other’s network services. This protocol runs on <strong>port 139</strong> and is independent from the SMB protocol. Modern implementations of SMB can work without NetBIOS, but both protocols are often enabled together.</p><p>We can use nmap to scan a host and detect this service: <code class="language-plaintext highlighter-rouge">nmap -v -p 139,445 1.1.1.1</code></p><p>There are other tools to identify NetBIOS information such as <strong>nbtscan</strong></p><h3 id="nmap-smb-nse-scripts"><span class="mr-2">Nmap SMB NSE Scripts</span><a href="#nmap-smb-nse-scripts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We mentioned that nmap is a super powerful tool. It has scripts that can help us to enum different services better such as SMB. The scripts are in <strong>/usr/share/nmap/scripts</strong> directory:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>❯ <span class="nb">ls</span> <span class="nt">-l</span> /usr/share/nmap/scripts/smb<span class="k">*</span>
.rw-r--r-- root root  44 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-brute.nse
.rw-r--r-- root root 5.2 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-double-pulsar-backdoor.nse
.rw-r--r-- root root 4.7 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-enum-domains.nse
.rw-r--r-- root root 5.8 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-enum-groups.nse
.rw-r--r-- root root 7.9 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-enum-processes.nse
.rw-r--r-- root root  27 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-enum-services.nse
.rw-r--r-- root root  12 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-enum-sessions.nse
.rw-r--r-- root root 6.8 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-enum-shares.nse
.rw-r--r-- root root  12 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-enum-users.nse
.rw-r--r-- root root 1.7 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-flood.nse
.rw-r--r-- root root 7.3 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-ls.nse
.rw-r--r-- root root 8.6 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-mbenum.nse
.rw-r--r-- root root 8.0 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-os-discovery.nse
.rw-r--r-- root root 4.9 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-print-text.nse
.rw-r--r-- root root 1.8 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-protocols.nse
.rw-r--r-- root root  62 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-psexec.nse
.rw-r--r-- root root 5.1 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-security-mode.nse
.rw-r--r-- root root 2.4 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-server-stats.nse
.rw-r--r-- root root  14 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-system-info.nse
.rw-r--r-- root root 7.3 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-vuln-conficker.nse
.rw-r--r-- root root  23 KB Sun Aug  8 19:40:33 2021  /usr/share/nmap/scripts/smb-vuln-cve-2017-7494.nse
...
</pre></table></code></div></div><p>We can use these scripts while running nmap with the <code class="language-plaintext highlighter-rouge">--script</code> option: <code class="language-plaintext highlighter-rouge">nmap -v -p 139,445 --script=smb-os-discovery 1.1.1.1</code>. In this example the script will try to identify the OS. We can make use of different scripts to check for known vulnerabilities or exploits.</p><h2 id="nfs-enumeration"><span class="mr-2">NFS Enumeration</span><a href="#nfs-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Network File System (NFS) is a distributed file system protocol. While SMB is often used on Windows OS, NFS is mostly used on Unix OS. This protocol is not secure by design and it can lead to sensitive information exposure.</p><p>NFS is an RPC service (Remote Procedure Call), so in order to serve the service to the clients, it makes use of <strong>portmapper</strong> and <strong>rpcbind</strong>. Portmapper maps RPC services to the ports they are listening on. When the client wants to use an RPC service, it contacts with the portmapper with the program number and then, portmapper redirects the client to the proper port number (where the requested program is running). Portmapper runs on <strong>port 111</strong>.</p><p>Like SMB, we can enumerate this service using <strong>nmap</strong> with some scripts like <strong>rpcinfo</strong>, which will find the registered RPC services: <code class="language-plaintext highlighter-rouge">nmap -sV -p 111 --script=rpcinfo 1.1.1.1</code>.</p><h3 id="nmap-nfs-nse-scripts"><span class="mr-2">Nmap NFS NSE Scripts</span><a href="#nmap-nfs-nse-scripts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Once we have detected NFS running on that host, we can use the NFS scripts that nmap has to collect additional information such as directories that can be mounted.</p><p>Let’s imagine that after running <code class="language-plaintext highlighter-rouge">nmap -p 111 --script nfs* 1.1.1.1</code> we see that the <strong>\home</strong> directory can be mounted in our system. Then we can use the <strong>mount</strong> command to do it (and the <strong>-o nolock</strong> option to disable file locking).</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>❯ <span class="nb">mkdir </span>external_home
❯ <span class="nb">sudo </span>mount <span class="nt">-o</span> nolock 1.1.1.1:/home ~/external_home/
❯ <span class="nb">cd </span>external_home
❯ <span class="nb">ls
</span>victim1 victim2 victim3
</pre></table></code></div></div><p>The <strong>victim1, victim2, victim3</strong> home directories are users from the victim machine and they are mounted on our system now. However, maybe we won’t have permission to access them because of the users needed. However, we can check the permissions with <code class="language-plaintext highlighter-rouge">ls -la</code> and see which users are able to access them. Then, we can create this users using the <strong>adduser</strong> command in our machine and do a <strong>su</strong> to that user. Then we will have an “imitation” of that user in our machine and we will be able to access these files/directories.</p><h2 id="smtp-enumeration"><span class="mr-2">SMTP Enumeration</span><a href="#smtp-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The Simple Mail Transport Protocol (SMTP) supports several commands that can give us interesting information. A <strong>VRFY</strong> request asks the server to verify an email address. The <strong>EXPN</strong> asks the server for the membership of a mailing list. Both commands can be used to search for existing users on a mail server.</p><h2 id="snmp-ennumeration"><span class="mr-2">SNMP Ennumeration</span><a href="#snmp-ennumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The Simple Network Management Protocol (SNMP) can be misconfigured and abused by attackers. It runs on <strong>port 161</strong> Since it uses UDP, is vulnerable to IP spoofing and replay attacks. Some of its protocols send unencrypted data and they have weak authentication schemes.</p><h3 id="snmp-mib-tree"><span class="mr-2">SNMP MIB Tree</span><a href="#snmp-mib-tree" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The SNMP Management Information Base (MIB) is a database that contains information about the network management. This DB is represented like a tree, where branches are different organizations or functions and leaves are specific variable values.</p><div class="table-wrapper"><table><thead><tr><th> <th> <tbody><tr><td>1.3.6.1.2.1.25.1.6.0<td>System Processes<tr><td>1.3.6.1.2.1.25.4.2.1.2<td>Running Programs<tr><td>1.3.6.1.2.1.25.4.2.1.4<td>Processes Path<tr><td>1.3.6.1.2.1.25.2.3.1.4<td>Storage Units<tr><td>1.3.6.1.2.1.25.6.3.1.2<td>Software Name<tr><td>1.3.6.1.4.1.77.1.2.25<td>User Accounts<tr><td>1.3.6.1.2.1.6.13.1.3<td>TCP Local Ports</table></div><h3 id="scanning-for-snmp"><span class="mr-2">Scanning for SNMP</span><a href="#scanning-for-snmp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Since SNMP uses UDP, if we use <strong>nmap</strong> we have to use the <strong>-sU</strong> option to do a UDP scan. Alternatively, we can use a tool like <a href="https://github.com/trailofbits/onesixtyone">onesixtyone</a> bit it will need to build text files containing community strings. A <strong>community string</strong> is like an ID that allows access to resources.</p><p>Once we have identified an SNMP service, we can start doing queries to extract data.</p><h3 id="windows-snmp-ennumeration"><span class="mr-2">Windows SNMP Ennumeration</span><a href="#windows-snmp-ennumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can use the <strong>snmpwalk</strong> tool to query for data. We have to provide a community string. The community string for read-only data is <strong>public</strong> in most cases.</p><p>By doing <code class="language-plaintext highlighter-rouge">snmpwalk -c public -v1 -t 10 1.1.1.1</code> we can enumerate all the MIB tree. However, if we want to get a specific value, such as user accounts, then we have to use the number related to this resource (specified in the previous table): <code class="language-plaintext highlighter-rouge">snmpwalk -c public -v1 -t 10 1.1.1.1 1.3.6.1.4.1.77.1.2.25</code>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/oscp-study-guide/'>OSCP-Study-Guide</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/oscp/" class="post-tag no-text-decoration" >OSCP</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=OSCP-7%3A+Active+Information+Gathering+-+Adri%C3%A0+Pag%C3%A8s&url=https%3A%2F%2Fadriapt.github.io%2Fposts%2FOSCP-7%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=OSCP-7%3A+Active+Information+Gathering+-+Adri%C3%A0+Pag%C3%A8s&u=https%3A%2F%2Fadriapt.github.io%2Fposts%2FOSCP-7%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fadriapt.github.io%2Fposts%2FOSCP-7%2F&text=OSCP-7%3A+Active+Information+Gathering+-+Adri%C3%A0+Pag%C3%A8s" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/CySA/">CySA+ Preparation Content</a><li><a href="/posts/HTB_Timelapse/">Htb_timelapse</a><li><a href="/posts/wellcome/">Welcome</a><li><a href="/posts/OSCP-Starting/">OSCP-Starting Point</a><li><a href="/posts/OSCP-9/">OSCP-9: Web-based Vulnerabilities</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/oscp/">OSCP</a> <a class="post-tag" href="/tags/active-directory/">Active_Directory</a> <a class="post-tag" href="/tags/basics/">Basics</a> <a class="post-tag" href="/tags/oscp-bash/">OSCP Bash</a> <a class="post-tag" href="/tags/windows/">Windows</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/OSCP-Starting/"><div class="card-body"> <em class="small" data-ts="1657951800" data-df="ll" > Jul 16, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OSCP-Starting Point</h3><div class="text-muted small"><p> OSCP STUDY WALKTHROUGH Edit: I was studying for the OSCP but I started a new job as a Security Analyst. Since this certification requires a lot of study and time, I decided to stop and invest tha...</p></div></div></a></div><div class="card"> <a href="/posts/OSCP-6/"><div class="card-body"> <em class="small" data-ts="1658211000" data-df="ll" > Jul 19, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OSCP-6: Passive Information Gathering</h3><div class="text-muted small"><p> Chapter 6: Passive Information Gathering Depending on the pentest that you are doing, the first step may be gathering openly available information about the target without directly interacting wi...</p></div></div></a></div><div class="card"> <a href="/posts/OSCP-8/"><div class="card-body"> <em class="small" data-ts="1658815800" data-df="ll" > Jul 26, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OSCP-8: Vulnerability Scanning</h3><div class="text-muted small"><p> Chapter 8: Vulnerability Scanning Vulnerability Scanning is the process of detecting a known exploit/vulnerability when analyzing a victim. There are automated tools that do this process. They sc...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/OSCP-6/" class="btn btn-outline-primary" prompt="Older"><p>OSCP-6: Passive Information Gathering</p></a> <a href="/posts/OSCP-8/" class="btn btn-outline-primary" prompt="Newer"><p>OSCP-8: Vulnerability Scanning</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="">Adrià Pagès Torruella</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/oscp/">OSCP</a> <a class="post-tag" href="/tags/active-directory/">Active_Directory</a> <a class="post-tag" href="/tags/basics/">Basics</a> <a class="post-tag" href="/tags/oscp-bash/">OSCP Bash</a> <a class="post-tag" href="/tags/windows/">Windows</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
